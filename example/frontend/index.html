<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Court - Fact Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
            background: rgba(255,255,255,0.2);
        }
        
        .status-badge.ready {
            background: #10b981;
        }
        
        .status-badge.error {
            background: #ef4444;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .input-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #374151;
            font-size: 1.1em;
        }
        
        .input-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .input-section textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result {
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .verdict-banner {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
        }
        
        .verdict-banner.supported,
        .verdict-banner.factual {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .verdict-banner.refuted,
        .verdict-banner.false {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .verdict-banner.suspicious,
        .verdict-banner.questionable {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #f59e0b;
        }
        
        .claim-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .claim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .claim-verdict {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .claim-verdict.supported,
        .claim-verdict.factual {
            background: #10b981;
            color: white;
        }
        
        .claim-verdict.refuted,
        .claim-verdict.false {
            background: #ef4444;
            color: white;
        }
        
        .claim-verdict.suspicious,
        .claim-verdict.questionable {
            background: #f59e0b;
            color: white;
        }
        
        .claim-text {
            font-size: 1em;
            color: #1f2937;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .claim-reasoning {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid #667eea;
        }
        
        .jury-votes {
            margin-top: 15px;
        }
        
        .jury-votes h4 {
            color: #374151;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .jury-vote {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .jury-vote-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .jury-name {
            font-weight: 600;
            color: #667eea;
        }
        
        .jury-decision {
            font-size: 0.85em;
            padding: 3px 10px;
            border-radius: 12px;
        }
        
        .jury-decision.no_objection {
            background: #d1fae5;
            color: #065f46;
        }
        
        .jury-decision.suspicious_fact,
        .jury-decision.reasonable_doubt {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .jury-decision.abstain {
            background: #e5e7eb;
            color: #6b7280;
            font-style: italic;
        }
        
        .jury-reason {
            color: #6b7280;
            font-size: 0.85em;
            margin-top: 5px;
            line-height: 1.4;
        }
        
        .jury-reference {
            background: #f3f4f6;
            padding: 8px;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 0.8em;
            border-left: 3px solid #667eea;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .precedents-section {
            background: #eff6ff;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid #3b82f6;
        }
        
        .precedents-section h4 {
            color: #1e40af;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .precedent-item {
            background: white;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 6px;
            font-size: 0.85em;
        }
        
        .precedent-similarity {
            color: #3b82f6;
            font-weight: 600;
        }
        
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #ef4444;
        }
        
        .info-box {
            background: #eff6ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
            font-size: 0.9em;
            color: #1e40af;
        }
        
        .examples {
            margin-top: 15px;
        }
        
        .example-btn {
            background: #e0e7ff;
            color: #4338ca;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            margin-right: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .example-btn:hover {
            background: #c7d2fe;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš–ï¸ Model Court</h1>
            <p>AI-Powered Fact Checking System</p>
            <div id="status" class="status-badge">Loading...</div>
        </div>
        
        <div class="card">
            <div class="input-section">
                <label for="inputText">è¾“å…¥éœ€è¦æ£€æŸ¥çš„æ–‡æœ¬å†…å®¹ï¼š</label>
                <textarea 
                    id="inputText" 
                    placeholder="è¯·è¾“å…¥ä»»ä½•éœ€è¦è¿›è¡Œäº‹å®æ ¸æŸ¥çš„æ–‡æœ¬å†…å®¹ï¼Œä¾‹å¦‚æ–°é—»ã€ç¤¾äº¤åª’ä½“å¸–å­ã€æˆ–ä»»ä½•å£°æ˜..."></textarea>
                
                <div class="examples">
                    <button class="example-btn" onclick="loadExample(1)">ç¤ºä¾‹ 1: ç§‘å­¦äº‹å®</button>
                    <button class="example-btn" onclick="loadExample(2)">ç¤ºä¾‹ 2: å¥åº·è°£è¨€</button>
                    <button class="example-btn" onclick="loadExample(3)">ç¤ºä¾‹ 3: æ··åˆå†…å®¹</button>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="checkBtn" onclick="checkFacts()">
                        ğŸ” å¼€å§‹æ£€æŸ¥
                    </button>
                    <button class="btn btn-secondary" onclick="clearInput()">
                        ğŸ—‘ï¸ æ¸…ç©º
                    </button>
                </div>
            </div>
            
            <div class="info-box">
                <strong>ğŸ’¡ å·¥ä½œåŸç†ï¼š</strong> Model Court ä½¿ç”¨å¤šä¸ªç‹¬ç«‹çš„ AI æ¨¡å‹ï¼ˆé™ªå®¡å›¢ï¼‰æ¥è¯„ä¼°æ‚¨çš„æ–‡æœ¬ã€‚
                æ¯ä¸ªæ¨¡å‹å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ï¼ˆé€»è¾‘æ¨ç†ã€ç½‘ç»œæœç´¢ã€çŸ¥è¯†åº“æŸ¥è¯¢ï¼‰æ¥åˆ¤æ–­å†…å®¹çš„çœŸå®æ€§ã€‚
                æœ€åï¼Œæ³•å®˜æ¨¡å‹ä¼šç»¼åˆæ‰€æœ‰é™ªå®¡å›¢çš„æ„è§ï¼Œç»™å‡ºæœ€ç»ˆåˆ¤å†³ã€‚
            </div>
        </div>
        
        <div id="loading" class="card loading" style="display: none;">
            <div class="spinner"></div>
            <p>æ­£åœ¨è¿›è¡Œäº‹å®æ ¸æŸ¥...</p>
            <p style="color: #6b7280; font-size: 0.9em; margin-top: 10px;">
                å¤šä¸ª AI æ¨¡å‹æ­£åœ¨ç‹¬ç«‹è¯„ä¼°æ‚¨çš„å†…å®¹
            </p>
        </div>
        
        <div id="result" class="card result">
            <!-- ç»“æœå°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
        </div>
        
        <div id="error" class="card" style="display: none;">
            <div class="error">
                <strong>âŒ é”™è¯¯ï¼š</strong>
                <p id="errorMessage"></p>
            </div>
        </div>
    </div>
    
    <script>
        // æ£€æŸ¥ API çŠ¶æ€
        async function checkStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                const statusEl = document.getElementById('status');
                
                if (data.status === 'ready') {
                    statusEl.textContent = `âœ… å°±ç»ª (${data.juries_count} ä¸ªè¯„å®¡æ¨¡å‹)`;
                    statusEl.className = 'status-badge ready';
                } else {
                    statusEl.textContent = 'âŒ åˆå§‹åŒ–å¤±è´¥';
                    statusEl.className = 'status-badge error';
                    showError('Court åˆå§‹åŒ–å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                document.getElementById('status').textContent = 'âŒ æ— æ³•è¿æ¥';
                document.getElementById('status').className = 'status-badge error';
                showError('æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ã€‚è¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œã€‚');
            }
        }
        
        // åŠ è½½ç¤ºä¾‹
        function loadExample(num) {
            const examples = {
                1: "è¿‘æ—¥ç¤¾äº¤åª’ä½“æµä¼ ï¼š\n1. å–é«˜åº¦ç™½é…’å¯ä»¥æ€æ­»ä½“å†…çš„æµæ„Ÿç—…æ¯’ã€‚\n2. åŸƒéš†Â·é©¬æ–¯å…‹å®£å¸ƒæ”¶è´­äº†å¯å£å¯ä¹å…¬å¸ã€‚",
                2: "åœ°çƒæ˜¯å¹³çš„ï¼Œè¿™æ˜¯è¢«å¹¿æ³›è¯å®çš„ç§‘å­¦äº‹å®ã€‚äººç±»ä»æœªç™»ä¸Šè¿‡æœˆçƒï¼Œæ‰€æœ‰çš„ç™»æœˆç…§ç‰‡éƒ½æ˜¯åœ¨å¥½è±åæ‹æ‘„çš„ã€‚",
                3: "äººç±»æœ‰ 206 å—éª¨å¤´ã€‚åœ°çƒç»•å¤ªé˜³å…¬è½¬éœ€è¦çº¦ 365.25 å¤©ã€‚ç–«è‹—ä¼šæ”¹å˜äººç±»çš„ DNAã€‚"
            };
            document.getElementById('inputText').value = examples[num];
        }
        
        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            document.getElementById('inputText').value = '';
            document.getElementById('result').classList.remove('show');
            document.getElementById('error').style.display = 'none';
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').style.display = 'block';
        }
        
        // äº‹å®æ£€æŸ¥
        async function checkFacts() {
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                alert('è¯·è¾“å…¥éœ€è¦æ£€æŸ¥çš„æ–‡æœ¬å†…å®¹');
                return;
            }
            
            // éšè—ä¹‹å‰çš„ç»“æœ
            document.getElementById('result').classList.remove('show');
            document.getElementById('error').style.display = 'none';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').style.display = 'block';
            document.getElementById('checkBtn').disabled = true;
            
            try {
                const response = await fetch('/api/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Unknown error');
                }
                
                displayResult(data);
                
            } catch (error) {
                showError('æ£€æŸ¥å¤±è´¥: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('checkBtn').disabled = false;
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResult(data) {
            const resultDiv = document.getElementById('result');
            
            let html = `
                <div class="verdict-banner ${data.overall}">
                    ${data.summary}
                </div>
            `;
            
            data.claims.forEach((claim, index) => {
                html += `
                    <div class="claim-item">
                        <div class="claim-header">
                            <h3>æŒ‡æ§ ${index + 1}</h3>
                            <span class="claim-verdict ${claim.verdict}">
                                ${getVerdictText(claim.verdict)}
                            </span>
                        </div>
                        
                        <div class="claim-text">${claim.text}</div>
                        
                        ${claim.from_cache ? `
                            <div style="background: #dbeafe; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #3b82f6;">
                                <strong>ğŸ“¦ [ç›´æ¥è£å®š]</strong> å‘½ä¸­å†å²æœ‰æ•ˆåˆ¤ä¾‹ (ID: ${claim.cache_id || 'N/A'})
                            </div>
                        ` : ''}
                        
                        ${claim.precedents && claim.precedents.length > 0 ? `
                            <div class="precedents-section">
                                <h4>ğŸ“š [å†å²åˆ¤ä¾‹] å‘ç° ${claim.precedents.length} æ¡ç›¸ä¼¼è¿‡å¾€æ¡ˆä»¶ï¼š</h4>
                                ${claim.precedents.map(p => `
                                    <div class="precedent-item">
                                        <span class="precedent-similarity">[ç›¸ä¼¼åº¦: ${(p.similarity * 100).toFixed(1)}%]</span>
                                        ${p.text.substring(0, 80)}${p.text.length > 80 ? '...' : ''}
                                        <span style="color: #6b7280;"> â†’ ${getVerdictText(p.verdict)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${!claim.from_cache ? `
                            <div class="jury-votes">
                                <h4>ğŸ‘¥ [é™ªå®¡å›¢æŠ•ç¥¨] (${claim.jury_votes.length} ä½è¯„å®¡å‘˜ï¼Œ${(claim.objection_ratio * 100).toFixed(0)}% æå‡ºå¼‚è®®):</h4>
                                ${claim.jury_votes.map(vote => `
                                    <div class="jury-vote">
                                        <div class="jury-vote-header">
                                            <span class="jury-name">${vote.jury_name}</span>
                                            <span class="jury-decision ${vote.decision}">
                                                ${getDecisionText(vote.decision)} (${(vote.confidence * 100).toFixed(0)}%)
                                            </span>
                                        </div>
                                        <div class="jury-reason"><strong>ç†ç”±:</strong> ${vote.reason}</div>
                                        ${vote.reference_summary ? `
                                            <div class="jury-reference">
                                                <strong>ğŸ“„ å‚è€ƒè¯æ®:</strong><br>
                                                ${vote.reference_summary.substring(0, 300)}${vote.reference_summary.length > 300 ? '...' : ''}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="claim-reasoning">
                                <strong>âš–ï¸ æ³•å®˜ç»¼è¿°ï¼š</strong>
                                <p>${claim.judge_reasoning}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `
                <div style="margin-top: 20px; padding: 15px; background: #f9fafb; border-radius: 8px; font-size: 0.9em; color: #6b7280;">
                    <strong>Case ID:</strong> ${data.case_id}<br>
                    <strong>Status:</strong> ${data.status}
                </div>
            `;
            
            resultDiv.innerHTML = html;
            resultDiv.classList.add('show');
        }
        
        function getVerdictText(verdict) {
            const texts = {
                'supported': 'âœ… SUPPORTED',
                'refuted': 'âŒ REFUTED',
                'suspicious': 'âš ï¸ SUSPICIOUS',
                'factual': 'âœ… äº‹å®å‡†ç¡®',
                'false': 'âŒ åŒ…å«è™šå‡ä¿¡æ¯',
                'questionable': 'âš ï¸ å­˜ç–‘'
            };
            return texts[verdict] || verdict.toUpperCase();
        }
        
        function getDecisionText(decision) {
            const texts = {
                'no_objection': 'æ— å¼‚è®®',
                'suspicious_fact': 'å­˜ç–‘',
                'reasonable_doubt': 'æœ‰åˆç†æ€€ç–‘',
                'abstain': 'ç¼ºå¸­'
            };
            return texts[decision] || decision;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = checkStatus;
    </script>
</body>
</html>

